<!doctype html>
<html lang="es">
    <head>
        <!-- Configuración básica del documento -->
        <meta charset="UTF-8" />
        <title>Analizador Semántico RSL</title>
        <!-- Enlaces a hojas de estilo y favicon -->
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/icon?family=Material+Icons"
        />
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='style.css') }}"
        />
        <link
            rel="icon"
            href="{{ url_for('static', filename='assets/logo.png') }}"
            type="image/png"
        />
    </head>
    <body>
        <!-- Encabezado de la página con logo y título -->
        <header>
            <img
                src="{{ url_for('static', filename='assets/logo.png') }}"
                alt="Logo del sitio"
            />
            <h1>Analizador Semántico para RSL</h1>
            <p class="intro-text">
                Analiza artículos científicos en PDF para extraer datos útiles
                para estudiantes e investigadores.
            </p>
        </header>

        <!-- Contenedor principal de la aplicación -->
        <div class="container">
            <!-- Sección izquierda: Carga y gestión de archivos -->
            <div id="files-list">
                <h3>Archivos Subidos</h3>
                <!-- Área para seleccionar y subir archivos -->
                <div id="file-upload-area">
                    <input
                        type="file"
                        id="file-input"
                        accept=".pdf"
                        style="display: none"
                    />
                    <button type="button" id="upload-btn" class="btn">
                        Seleccionar Archivo PDF
                    </button>
                    <!-- Muestra mensajes de estado (subiendo, éxito, error) -->
                    <div id="upload-status"></div>
                </div>
                <!-- Lista donde se mostrarán los archivos subidos dinámicamente -->
                <ul id="files-container"></ul>
                <!-- Formulario para iniciar la extracción de datos de los archivos en la lista -->
                <form id="extract-form" class="form-section">
                    <button type="submit" class="btn" id="extract-btn" disabled>
                        Extraer Datos
                    </button>
                </form>
            </div>

            <!-- Sección derecha: Búsqueda y visualización de resultados -->
            <div>
                <!-- Separador visual entre carga y búsqueda -->
                <div class="demo">
                    <div class="line"></div>
                    <h3>O</h3>
                    <div class="line"></div>
                </div>

                <!-- Formulario para buscar artículos por tema en los archivos ya procesados -->
                <form method="POST" action="/buscar" class="form-section">
                    <div>
                        <input
                            type="text"
                            name="buscar_tema"
                            placeholder="Buscar por tema"
                        />
                        <button type="submit" class="btn">Buscar</button>
                    </div>

                    <!-- Muestra un mensaje de error si ocurre alguno durante la búsqueda -->
                    {% if error %}
                    <p class="error-message" style="margin-top: 20px">
                        {{ error }}
                    </p>
                    {% endif %}
                </form>

                <!-- Contenedor para los datos extraídos -->
                <div class="data-container">
                    <!-- Solo se muestra si hay datos en la lista `lista_datos` -->
                    {% if lista_datos %}
                    <!-- Opciones para mostrar u ocultar columnas de la tabla -->
                    <div class="options-container">
                        <h3>Selecciona las columnas a mostrar:</h3>
                        <div>
                            <label
                                ><input
                                    type="checkbox"
                                    name="autores"
                                    onchange="alternarColumna(this, 'autores')"
                                    checked
                                />Autores</label
                            >
                            <label
                                ><input
                                    type="checkbox"
                                    name="anio"
                                    onchange="alternarColumna(this, 'anio')"
                                    checked
                                />Año</label
                            >
                            <label
                                ><input
                                    type="checkbox"
                                    name="tema"
                                    onchange="alternarColumna(this, 'tema')"
                                    checked
                                />Tema</label
                            >
                            <label
                                ><input
                                    type="checkbox"
                                    name="pais"
                                    onchange="alternarColumna(this, 'pais')"
                                    checked
                                />País</label
                            >
                            <label
                                ><input
                                    type="checkbox"
                                    name="palabras"
                                    onchange="alternarColumna(this, 'palabras')"
                                />Palabras Clave</label
                            >
                            <label
                                ><input
                                    type="checkbox"
                                    name="paginas_imagenes"
                                    onchange="alternarColumna(this, 'paginas_imagenes')"
                                />Páginas / Imágenes</label
                            >
                            <label
                                ><input
                                    type="checkbox"
                                    name="resumen"
                                    onchange="alternarColumna(this, 'resumen')"
                                />Resumen</label
                            >
                        </div>
                    </div>

                    <!-- Contenedor de la tabla de resultados -->
                    <div class="table-container">
                        <table class="mui-table">
                            <thead>
                                <tr>
                                    <!-- Encabezados de la tabla -->
                                    <th data-columna="titulo">Título</th>
                                    <th data-columna="autores">Autores</th>
                                    <th data-columna="anio">Año</th>
                                    <th data-columna="tema">Tema</th>
                                    <th data-columna="pais">País</th>
                                    <th data-columna="palabras">
                                        Palabras Clave
                                    </th>
                                    <th data-columna="paginas_imagenes">
                                        Páginas / Imágenes
                                    </th>
                                    <th data-columna="resumen">Resumen</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Itera sobre la lista de datos para crear una fila por cada artículo -->
                                {% for dato in lista_datos %}
                                <tr>
                                    <td data-columna="titulo">
                                        {{ dato["titulo"] }}
                                    </td>
                                    <td data-columna="autores">
                                        {{ dato["autores"] }}
                                    </td>
                                    <td data-columna="anio">
                                        {{ dato["anio"] }}
                                    </td>
                                    <td data-columna="tema">
                                        {{ dato["tema"] }}
                                    </td>
                                    <td data-columna="pais">
                                        {{ dato["pais"] }}
                                    </td>
                                    <td data-columna="palabras">
                                        {{ dato["palabras"] }}
                                    </td>
                                    <td data-columna="paginas_imagenes">
                                        {{ dato['paginas_imagenes'] }}
                                    </td>
                                    <td data-columna="resumen">
                                        {{ dato["resumen"] }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Contenedor para los botones de acción (exportar y ver estadísticas) -->
                    <div class="buttons-container">
                        <div class="export-container">
                            <p>
                                ¿Quieres exportar los resultados a un archivo
                                Excel?
                            </p>
                            <a
                                href="#"
                                class="btn"
                                onclick="enviarDatosExcel(event)"
                                >Exportar a Excel</a
                            >
                        </div>
                        <div class="export-container">
                            <p>
                                ¿Quieres conocer más acerca de tus resultados?
                            </p>
                            <a href="/estadisticas" class="btn"
                                >Ver más detalles</a
                            >
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Scripts de JavaScript que controlan la interactividad de la página -->
        <script src="{{ url_for('static', filename='script.js') }}"></script>
        <script src="{{ url_for('static', filename='file-manager.js') }}"></script>
    </body>
</html>
